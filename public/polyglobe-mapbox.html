<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ProofLocker Globe</title>

  <!-- Mapbox GL JS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #111111;
      --bg-card: #1a1a1a;
      --text-primary: #ffffff;
      --text-secondary: #9ca3af;
      --accent-purple: #9333ea;
      --accent-blue: #2E5CFF;
      --accent-red: #ff3b3b;
      --accent-verified: #10b981;
      --accent-disputed: #ef4444;
      --accent-pending: #f59e0b;
      --border: #1f1f1f;
      --shadow-glow: rgba(147, 51, 234, 0.3);
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow: hidden;
    }

    /* Top Header - ProofLocker Style */
    .top-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 64px;
      background: linear-gradient(to right, #0A0A0F, #050509);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      z-index: 1000;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }

    .logo img {
      height: 32px;
      width: auto;
      cursor: pointer;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 24px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.2s;
      position: relative;
      padding-bottom: 2px;
    }

    .nav-link:hover {
      color: var(--accent-blue);
    }

    .nav-link.active {
      color: var(--accent-blue);
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--accent-blue);
      transition: width 0.2s;
    }

    .nav-link:hover::after,
    .nav-link.active::after {
      width: 100%;
    }

    .nav-link svg {
      width: 16px;
      height: 16px;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
    }

    .btn-primary {
      background: linear-gradient(to right, var(--accent-blue), #5B21B6);
      color: white;
      box-shadow: 0 4px 12px rgba(46, 92, 255, 0.3);
    }

    .btn-primary:hover {
      background: linear-gradient(to right, #3D6CFF, #6B31C6);
      box-shadow: 0 0 20px rgba(46, 92, 255, 0.5);
      transform: translateY(-1px);
    }

    .btn-ghost {
      background: transparent;
      color: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-ghost:hover {
      color: white;
      border-color: var(--accent-blue);
      background: rgba(46, 92, 255, 0.1);
    }

    .reputation-pill {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(147, 51, 234, 0.15);
      border: 1px solid rgba(147, 51, 234, 0.3);
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: var(--accent-purple);
      cursor: pointer;
      transition: all 0.2s;
    }

    .reputation-pill:hover {
      background: rgba(147, 51, 234, 0.25);
      border-color: var(--accent-purple);
    }

    .reputation-pill i {
      font-size: 11px;
    }

    .profile-btn {
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      transition: all 0.2s;
    }

    .profile-btn:hover {
      color: white;
      background: rgba(255, 255, 255, 0.1);
    }

    .profile-btn svg {
      width: 14px;
      height: 14px;
    }

    .profile-menu {
      display: none;
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      width: 200px;
      background: rgba(17, 17, 17, 0.98);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
      padding: 8px;
      z-index: 1001;
    }

    .profile-menu.open {
      display: block;
    }

    .profile-menu-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .profile-menu-item:hover {
      background: rgba(255, 255, 255, 0.05);
      color: white;
    }

    .profile-menu-item svg {
      width: 16px;
      height: 16px;
    }

    .profile-menu-divider {
      height: 1px;
      background: rgba(255, 255, 255, 0.1);
      margin: 8px 0;
    }

    /* Left Sidebar with Feeds */
    .feed-sidebar {
      position: fixed;
      top: 64px;
      left: 0;
      width: 380px;
      height: calc(100vh - 64px);
      background: rgba(10, 10, 10, 0.95);
      backdrop-filter: blur(30px);
      border-right: 1px solid var(--border);
      z-index: 900;
      display: flex;
      flex-direction: column;
    }

    /* OSINT Monitor Section */
    .osint-monitor {
      flex: 1;
      display: flex;
      flex-direction: column;
      border-bottom: 1px solid var(--border);
      max-height: 50%;
    }

    .feed-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .feed-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 600;
    }

    .feed-title.osint {
      color: var(--accent-red);
    }

    .feed-title.claims {
      color: var(--accent-purple);
    }

    .feed-badge {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-secondary);
    }

    .feed-content {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
    }

    .feed-content::-webkit-scrollbar {
      width: 4px;
    }

    .feed-content::-webkit-scrollbar-track {
      background: transparent;
    }

    .feed-content::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 2px;
    }

    /* News Item */
    .news-item {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-left: 3px solid var(--accent-red);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .news-item:hover {
      background: rgba(255, 59, 59, 0.05);
      border-color: var(--accent-red);
    }

    .news-item.selected {
      background: rgba(255, 59, 59, 0.1);
      border-color: var(--accent-red);
    }

    .news-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .news-source-icon {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      background: var(--accent-red);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 11px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .news-source {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .news-time {
      margin-left: auto;
      font-size: 10px;
      color: var(--text-secondary);
    }

    .news-snippet {
      font-size: 12px;
      line-height: 1.5;
      color: var(--text-secondary);
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .news-tags {
      display: flex;
      gap: 4px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .news-tag {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 4px;
      background: rgba(255, 59, 59, 0.1);
      color: var(--accent-red);
    }

    /* Claims Section */
    .claims-monitor {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-height: 50%;
    }

    /* Claim Item */
    .claim-item {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-left: 3px solid var(--accent-purple);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .claim-item:hover {
      background: rgba(147, 51, 234, 0.05);
      border-color: var(--accent-purple);
    }

    .claim-item.selected {
      background: rgba(147, 51, 234, 0.1);
      border-color: var(--accent-purple);
    }

    .claim-item.resolved-true {
      border-left-color: var(--accent-verified);
    }

    .claim-item.resolved-false {
      border-left-color: var(--accent-disputed);
    }

    .claim-item.resolved-void {
      border-left-color: #6b7280;
    }

    .claim-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .claim-author {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
    }

    .claim-handle {
      font-weight: 600;
      color: var(--text-primary);
    }

    .claim-rep {
      display: flex;
      align-items: center;
      gap: 3px;
      padding: 2px 6px;
      border-radius: 10px;
      background: rgba(147, 51, 234, 0.15);
      color: var(--accent-purple);
      font-size: 10px;
      font-weight: 600;
    }

    .claim-status {
      font-size: 9px;
      padding: 3px 6px;
      border-radius: 10px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .claim-status.open {
      background: rgba(147, 51, 234, 0.15);
      color: var(--accent-purple);
    }

    .claim-status.resolved-true {
      background: rgba(16, 185, 129, 0.15);
      color: var(--accent-verified);
    }

    .claim-status.resolved-false {
      background: rgba(239, 68, 68, 0.15);
      color: var(--accent-disputed);
    }

    .claim-status.resolved-void {
      background: rgba(107, 114, 128, 0.15);
      color: #9ca3af;
    }

    .claim-text {
      font-size: 12px;
      line-height: 1.5;
      color: var(--text-primary);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .claim-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 10px;
      color: var(--text-secondary);
    }

    /* Map Container */
    #map {
      position: fixed;
      top: 64px;
      left: 380px;
      right: 0;
      bottom: 0;
      width: calc(100% - 380px);
    }

    /* Map Controls */
    .map-controls {
      position: fixed;
      top: 84px;
      right: 20px;
      z-index: 900;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .map-control-btn {
      width: 40px;
      height: 40px;
      background: rgba(17, 17, 17, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text-secondary);
    }

    .map-control-btn:hover {
      border-color: var(--accent-purple);
      color: var(--accent-purple);
    }

    .map-control-btn.active {
      background: var(--accent-purple);
      color: white;
      border-color: var(--accent-purple);
    }

    /* Vignette */
    .vignette {
      position: fixed;
      top: 64px;
      left: 380px;
      right: 0;
      bottom: 0;
      pointer-events: none;
      background: radial-gradient(ellipse at center, transparent 0%, rgba(147, 51, 234, 0.03) 60%, rgba(0, 0, 0, 0.2) 100%);
      z-index: 700;
    }

    /* Map Tooltip */
    .map-tooltip {
      position: fixed;
      background: rgba(17, 17, 17, 0.98);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      pointer-events: none;
      display: none;
      z-index: 1001;
      max-width: 300px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
    }

    .map-tooltip.visible {
      display: block;
    }

    .tooltip-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-primary);
    }

    .tooltip-meta {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .nav-links {
        display: none;
      }

      .feed-sidebar {
        width: 320px;
      }

      #map {
        left: 320px;
        width: calc(100% - 320px);
      }

      .vignette {
        left: 320px;
      }
    }

    @media (max-width: 768px) {
      .feed-sidebar {
        width: 100%;
        left: -100%;
        transition: left 0.3s;
      }

      .feed-sidebar.open {
        left: 0;
      }

      #map {
        left: 0;
        width: 100%;
      }

      .vignette {
        left: 0;
      }

      .map-controls {
        left: 20px;
        right: auto;
      }
    }

    /* Hide Mapbox attribution */
    .mapboxgl-ctrl-bottom-left,
    .mapboxgl-ctrl-bottom-right {
      display: none;
    }

    .mapboxgl-ctrl-logo {
      display: none !important;
    }

    /* Live indicator */
    .live-indicator {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 10px;
      color: var(--accent-red);
    }

    .live-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent-red);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body>

  <!-- Top Header -->
  <header class="top-header">
    <div class="logo">
      <a href="/">
        <img src="/logos/prooflocker-logo-dark.svg" alt="ProofLocker">
      </a>
    </div>

    <nav class="nav-links">
      <a href="/" class="nav-link">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
        Home
      </a>
      <a href="/app" class="nav-link">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        Explore
      </a>
      <a href="/globe" class="nav-link active">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Globe
      </a>
      <a href="/how-scoring-works" class="nav-link">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
        </svg>
        Scoring
      </a>
      <a href="/leaderboard" class="nav-link">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
        </svg>
        Leaderboard
      </a>
    </nav>

    <div class="header-actions">
      <a href="/lock" class="btn btn-primary">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
        </svg>
        Lock Prediction
      </a>

      <div class="reputation-pill" onclick="window.location.href='/how-scoring-works'">
        <i class="fas fa-star"></i>
        <span>1,247</span>
      </div>

      <div class="profile-btn" onclick="toggleProfileMenu()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        <span>@anon_user</span>

        <div class="profile-menu" id="profileMenu">
          <a href="/profile" class="profile-menu-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            Profile
          </a>
          <a href="/app?tab=my" class="profile-menu-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            My Predictions
          </a>
          <a href="/dashboard" class="profile-menu-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
            Dashboard
          </a>
          <div class="profile-menu-divider"></div>
          <div class="profile-menu-item" onclick="alert('Sign out clicked')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
            </svg>
            Sign out
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Left Sidebar with Feeds -->
  <aside class="feed-sidebar">
    <!-- OSINT Monitor -->
    <div class="osint-monitor">
      <div class="feed-header">
        <div class="feed-title osint">
          <i class="fas fa-satellite-dish"></i>
          OSINT Monitor
          <div class="live-indicator">
            <span class="live-dot"></span>
            LIVE
          </div>
        </div>
        <span class="feed-badge" id="osintCount">12</span>
      </div>
      <div class="feed-content" id="osintFeed">
        <!-- Dynamically filled -->
      </div>
    </div>

    <!-- Claims Monitor -->
    <div class="claims-monitor">
      <div class="feed-header">
        <div class="feed-title claims">
          <i class="fas fa-lock"></i>
          Active Claims
        </div>
        <span class="feed-badge" id="claimsCount">8</span>
      </div>
      <div class="feed-content" id="claimsFeed">
        <!-- Dynamically filled -->
      </div>
    </div>
  </aside>

  <!-- Map -->
  <div id="map"></div>
  <div class="vignette"></div>

  <!-- Map Tooltip -->
  <div id="mapTooltip" class="map-tooltip"></div>

  <!-- Map Controls -->
  <div class="map-controls">
    <div class="map-control-btn" title="Toggle OSINT" onclick="toggleOSINT()">
      <i class="fas fa-eye"></i>
    </div>
    <div class="map-control-btn" title="Toggle Claims" onclick="toggleClaims()">
      <i class="fas fa-lock"></i>
    </div>
    <div class="map-control-btn" title="Reset View" onclick="resetView()">
      <i class="fas fa-redo"></i>
    </div>
  </div>

  <script>
    // Mapbox Config
    mapboxgl.accessToken = "pk.eyJ1IjoicHJvb2Zsb2NrZXIiLCJhIjoiY21sYjBxcTAwMGVoYzNlczI4YWlzampqZyJ9.nY-yqSucTzvNyK1qDCq9rQ";

    // Profile Menu Toggle
    function toggleProfileMenu() {
      const menu = document.getElementById('profileMenu');
      menu.classList.toggle('open');
      event.stopPropagation();
    }

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      const menu = document.getElementById('profileMenu');
      const profileBtn = document.querySelector('.profile-btn');
      if (!profileBtn.contains(e.target)) {
        menu.classList.remove('open');
      }
    });

    // Mock Data Generator
    const sources = ["Bellingcat", "IntelCrab", "OSINT Tech", "Aurora Intel"];
    const regions = {
      europe: [[2.3522, 48.8566], [-0.1276, 51.5074], [13.4050, 52.5200], [30.5234, 50.4501]],
      asia: [[116.4074, 39.9042], [139.6917, 35.6895], [55.2708, 25.2048], [37.6173, 55.7558]],
      americas: [[-74.006, 40.7128], [-99.1332, 19.4326], [-118.2437, 34.0522], [-43.1729, -22.9068]],
      oceania: [[151.2093, -33.8688]]
    };

    const newsTemplates = [
      "Investigation reveals coordinated disinformation across multiple countries",
      "Satellite imagery confirms infrastructure changes in disputed region",
      "Public records show pattern inconsistencies in recent claims",
      "Crowdsourced verification completed with high confidence level",
      "Video authentication techniques published in new forensics report",
      "Supply chain tracking reveals significant pattern deviations",
      "Election monitoring data shows voting pattern irregularities",
      "Energy infrastructure sabotage evidence emerges",
      "Financial transaction patterns suggest money laundering network",
      "Military equipment movement tracked via commercial satellites",
      "Social media manipulation campaign targets regional elections",
      "Cybersecurity breach exposes government communications"
    ];

    const claimTemplates = [
      "Election outcome in District 5 will favor candidate A",
      "GDP growth Q1 2024 will exceed 3.5%",
      "Tech merger will be approved by regulatory bodies",
      "Climate summit will result in binding emissions targets",
      "Policy implementation will be delayed beyond Q2",
      "Market volatility will decrease in tech sector",
      "International treaty ratification before end of quarter",
      "Resource allocation decision favors renewable energy"
    ];

    // Generate initial OSINT data
    let osintData = Array.from({length: 12}, (_, i) => {
      const regionKeys = Object.keys(regions);
      const regionKey = regionKeys[Math.floor(Math.random() * regionKeys.length)];
      const coords = regions[regionKey];
      const location = coords[Math.floor(Math.random() * coords.length)];

      return {
        id: i + 1,
        title: newsTemplates[i % newsTemplates.length],
        source: sources[Math.floor(Math.random() * sources.length)],
        timestamp: `${Math.floor(Math.random() * 24)}h ago`,
        tags: ["OSINT", "Verification"],
        location: location,
        createdAt: Date.now() - (i * 3600000)
      };
    });

    // Generate claims data
    const claimsData = Array.from({length: 8}, (_, i) => {
      const regionKeys = Object.keys(regions);
      const regionKey = regionKeys[Math.floor(Math.random() * regionKeys.length)];
      const coords = regions[regionKey];
      const location = coords[Math.floor(Math.random() * coords.length)];
      const isResolved = Math.random() > 0.5;
      const outcomes = ["true", "false", "void"];

      return {
        id: i + 1,
        claim: claimTemplates[i % claimTemplates.length],
        status: isResolved ? "resolved" : "open",
        outcome: isResolved ? outcomes[Math.floor(Math.random() * outcomes.length)] : null,
        authorHandle: `@User${i + 1}`,
        authorRep: 70 + Math.floor(Math.random() * 30),
        lockedAt: `${Math.floor(Math.random() * 5)}d ago`,
        location: location
      };
    });

    let selectedOSINTId = null;
    let selectedClaimId = null;

    // Initialize Map
    const map = new mapboxgl.Map({
      container: "map",
      style: "mapbox://styles/mapbox/dark-v11",
      projection: "globe",
      center: [15, 35],
      zoom: 1.5,
      antialias: true,
      attributionControl: false
    });

    map.on("style.load", () => {
      map.setFog({
        "range": [0.5, 10],
        "color": "#000000",
        "horizon-blend": 0.05,
        "high-color": "#0a0a0a",
        "space-color": "#000000",
        "star-intensity": 0.15
      });

      // Add OSINT source with clustering
      map.addSource("osint", {
        type: "geojson",
        data: {
          type: "FeatureCollection",
          features: osintData.map(item => ({
            type: "Feature",
            geometry: { type: "Point", coordinates: item.location },
            properties: { ...item, tags: JSON.stringify(item.tags) }
          }))
        },
        cluster: true,
        clusterRadius: 60,
        clusterMaxZoom: 6
      });

      // Add Claims source with clustering
      map.addSource("claims", {
        type: "geojson",
        data: {
          type: "FeatureCollection",
          features: claimsData.map(item => ({
            type: "Feature",
            geometry: { type: "Point", coordinates: item.location },
            properties: { ...item }
          }))
        },
        cluster: true,
        clusterRadius: 50,
        clusterMaxZoom: 6
      });

      // OSINT Layers (red heat)
      map.addLayer({
        id: "osint-clusters",
        type: "circle",
        source: "osint",
        filter: ["has", "point_count"],
        paint: {
          "circle-color": "#ff3b3b",
          "circle-radius": ["step", ["get", "point_count"], 20, 3, 30, 5, 40],
          "circle-blur": 0.9,
          "circle-opacity": 0.25
        }
      });

      map.addLayer({
        id: "osint-cluster-count",
        type: "symbol",
        source: "osint",
        filter: ["has", "point_count"],
        layout: {
          "text-field": "{point_count_abbreviated}",
          "text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"],
          "text-size": 11
        },
        paint: { "text-color": "#ffffff" }
      });

      map.addLayer({
        id: "osint-unclustered",
        type: "circle",
        source: "osint",
        filter: ["!", ["has", "point_count"]],
        paint: {
          "circle-color": "#ff3b3b",
          "circle-radius": 8,
          "circle-blur": 0.5,
          "circle-opacity": 0.6,
          "circle-stroke-width": 1,
          "circle-stroke-color": "#ffffff",
          "circle-stroke-opacity": 0.4
        }
      });

      // Claims Layers
      map.addLayer({
        id: "claims-clusters-glow",
        type: "circle",
        source: "claims",
        filter: ["has", "point_count"],
        paint: {
          "circle-color": "#8a5cf6",
          "circle-radius": ["step", ["get", "point_count"], 25, 3, 35, 5, 45],
          "circle-blur": 0.7,
          "circle-opacity": 0.2
        }
      });

      map.addLayer({
        id: "claims-clusters-core",
        type: "circle",
        source: "claims",
        filter: ["has", "point_count"],
        paint: {
          "circle-color": "#8a5cf6",
          "circle-radius": ["step", ["get", "point_count"], 12, 3, 18, 5, 24],
          "circle-opacity": 0.8,
          "circle-stroke-width": 2,
          "circle-stroke-color": "#ffffff",
          "circle-stroke-opacity": 0.6
        }
      });

      map.addLayer({
        id: "claims-cluster-count",
        type: "symbol",
        source: "claims",
        filter: ["has", "point_count"],
        layout: {
          "text-field": "{point_count_abbreviated}",
          "text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"],
          "text-size": 11
        },
        paint: { "text-color": "#ffffff" }
      });

      map.addLayer({
        id: "claims-unclustered-glow",
        type: "circle",
        source: "claims",
        filter: ["!", ["has", "point_count"]],
        paint: {
          "circle-color": [
            "case",
            ["==", ["get", "outcome"], "true"], "#10b981",
            ["==", ["get", "outcome"], "false"], "#ef4444",
            ["==", ["get", "outcome"], "void"], "#6b7280",
            "#8a5cf6"
          ],
          "circle-radius": 14,
          "circle-blur": 0.6,
          "circle-opacity": 0.3
        }
      });

      map.addLayer({
        id: "claims-unclustered-core",
        type: "circle",
        source: "claims",
        filter: ["!", ["has", "point_count"]],
        paint: {
          "circle-color": [
            "case",
            ["==", ["get", "outcome"], "true"], "#10b981",
            ["==", ["get", "outcome"], "false"], "#ef4444",
            ["==", ["get", "outcome"], "void"], "#6b7280",
            "#8a5cf6"
          ],
          "circle-radius": 7,
          "circle-opacity": 0.9,
          "circle-stroke-width": 2,
          "circle-stroke-color": "#ffffff",
          "circle-stroke-opacity": 0.8
        }
      });

      // Hover interactions
      const tooltip = document.getElementById('mapTooltip');

      function updateTooltip(e, sourceId) {
        const features = map.queryRenderedFeatures(e.point, {
          layers: sourceId === 'claims'
            ? ['claims-clusters-core', 'claims-unclustered-core']
            : ['osint-clusters', 'osint-unclustered']
        });

        if (features.length > 0) {
          const props = features[0].properties;

          if (props.cluster) {
            const pointCount = props.point_count;
            tooltip.innerHTML = `
              <div class="tooltip-title">${pointCount} ${sourceId === 'claims' ? 'Claims' : 'Signals'}</div>
              <div class="tooltip-meta">Click to expand</div>
            `;
          } else {
            if (sourceId === 'claims') {
              const statusText = props.status === 'resolved' ? props.outcome : 'Open';
              tooltip.innerHTML = `
                <div class="tooltip-title">${props.claim}</div>
                <div class="tooltip-meta">${props.authorHandle} • Rep: ${props.authorRep}</div>
                <div class="tooltip-meta">Status: ${statusText}</div>
              `;
            } else {
              tooltip.innerHTML = `
                <div class="tooltip-title">${props.title}</div>
                <div class="tooltip-meta">${props.source} • ${props.timestamp}</div>
              `;
            }
          }

          tooltip.style.left = e.point.x + 15 + 'px';
          tooltip.style.top = e.point.y + 15 + 'px';
          tooltip.classList.add('visible');
        } else {
          tooltip.classList.remove('visible');
        }
      }

      ['claims-clusters-core', 'claims-unclustered-core'].forEach(layer => {
        map.on('mousemove', layer, (e) => updateTooltip(e, 'claims'));
        map.on('mouseleave', layer, () => tooltip.classList.remove('visible'));
      });

      ['osint-clusters', 'osint-unclustered'].forEach(layer => {
        map.on('mousemove', layer, (e) => {
          const claimsFeatures = map.queryRenderedFeatures(e.point, { layers: ['claims-clusters-core', 'claims-unclustered-core'] });
          if (claimsFeatures.length === 0) updateTooltip(e, 'osint');
        });
        map.on('mouseleave', layer, () => tooltip.classList.remove('visible'));
      });

      // Click interactions
      map.on('click', 'osint-clusters', (e) => {
        const clusterId = e.features[0].properties.cluster_id;
        map.getSource('osint').getClusterExpansionZoom(clusterId, (err, zoom) => {
          if (!err) map.easeTo({ center: e.features[0].geometry.coordinates, zoom: zoom });
        });
      });

      map.on('click', 'claims-clusters-core', (e) => {
        const clusterId = e.features[0].properties.cluster_id;
        map.getSource('claims').getClusterExpansionZoom(clusterId, (err, zoom) => {
          if (!err) map.easeTo({ center: e.features[0].geometry.coordinates, zoom: zoom });
        });
      });

      map.on('click', 'osint-unclustered', (e) => {
        const id = e.features[0].properties.id;
        map.easeTo({ center: e.features[0].geometry.coordinates, zoom: 5, duration: 1000 });
        selectOSINT(id);
      });

      map.on('click', 'claims-unclustered-core', (e) => {
        const id = e.features[0].properties.id;
        map.easeTo({ center: e.features[0].geometry.coordinates, zoom: 5, duration: 1000 });
        selectClaim(id);
      });

      ['claims-clusters-core', 'claims-unclustered-core', 'osint-clusters', 'osint-unclustered'].forEach(layer => {
        map.on('mouseenter', layer, () => { map.getCanvas().style.cursor = 'pointer'; });
        map.on('mouseleave', layer, () => { map.getCanvas().style.cursor = ''; });
      });

      map.on("idle", () => {
        if (map.getZoom() < 2) map.rotateTo(map.getBearing() + 10, { duration: 60000 });
      });
    });

    // Render feeds
    function renderOSINT() {
      const container = document.getElementById('osintFeed');
      container.innerHTML = osintData.slice(0, 20).map(item => `
        <div class="news-item ${selectedOSINTId === item.id ? 'selected' : ''}" data-id="${item.id}" onclick="selectOSINT(${item.id}); flyToLocation([${item.location[0]}, ${item.location[1]}]);">
          <div class="news-header">
            <div class="news-source-icon">${item.source.charAt(0)}</div>
            <div class="news-source">${item.source}</div>
            <div class="news-time">${item.timestamp}</div>
          </div>
          <div class="news-snippet">${item.title}</div>
          <div class="news-tags">
            ${item.tags.map(tag => `<span class="news-tag">#${tag}</span>`).join('')}
          </div>
        </div>
      `).join('');
      document.getElementById('osintCount').textContent = osintData.length;
    }

    function renderClaims() {
      const container = document.getElementById('claimsFeed');
      container.innerHTML = claimsData.map(item => {
        const statusClass = item.status === 'resolved' ? `resolved-${item.outcome}` : 'open';
        const statusText = item.status === 'resolved' ? item.outcome : 'open';
        return `
          <div class="claim-item ${statusClass} ${selectedClaimId === item.id ? 'selected' : ''}" data-id="${item.id}" onclick="selectClaim(${item.id}); flyToLocation([${item.location[0]}, ${item.location[1]}]);">
            <div class="claim-header">
              <div class="claim-author">
                <span class="claim-handle">${item.authorHandle}</span>
                <span class="claim-rep"><i class="fas fa-star"></i> ${item.authorRep}</span>
              </div>
              <span class="claim-status ${statusClass}">${statusText}</span>
            </div>
            <div class="claim-text">${item.claim}</div>
            <div class="claim-footer">
              <span>Locked ${item.lockedAt}</span>
            </div>
          </div>
        `;
      }).join('');
      document.getElementById('claimsCount').textContent = claimsData.length;
    }

    function selectOSINT(id) {
      selectedOSINTId = id;
      renderOSINT();
    }

    function selectClaim(id) {
      selectedClaimId = id;
      renderClaims();
    }

    function flyToLocation(coords) {
      map.flyTo({ center: coords, zoom: 5, duration: 1500 });
    }

    function toggleOSINT() {
      const visible = map.getLayoutProperty('osint-clusters', 'visibility') === 'visible';
      const visibility = visible ? 'none' : 'visible';
      ['osint-clusters', 'osint-cluster-count', 'osint-unclustered'].forEach(layer => {
        map.setLayoutProperty(layer, 'visibility', visibility);
      });
    }

    function toggleClaims() {
      const visible = map.getLayoutProperty('claims-clusters-core', 'visibility') === 'visible';
      const visibility = visible ? 'none' : 'visible';
      ['claims-clusters-glow', 'claims-clusters-core', 'claims-cluster-count', 'claims-unclustered-glow', 'claims-unclustered-core'].forEach(layer => {
        map.setLayoutProperty(layer, 'visibility', visibility);
      });
    }

    function resetView() {
      map.flyTo({ center: [15, 35], zoom: 1.5, duration: 2000 });
    }

    // Auto-refresh OSINT feed every 45 seconds
    setInterval(() => {
      if (osintData.length > 20) {
        osintData = osintData.slice(0, 20);
      }

      const regionKeys = Object.keys(regions);
      const regionKey = regionKeys[Math.floor(Math.random() * regionKeys.length)];
      const coords = regions[regionKey];
      const location = coords[Math.floor(Math.random() * coords.length)];

      const newItem = {
        id: Date.now(),
        title: newsTemplates[Math.floor(Math.random() * newsTemplates.length)],
        source: sources[Math.floor(Math.random() * sources.length)],
        timestamp: "Just now",
        tags: ["OSINT", "Verification"],
        location: location,
        createdAt: Date.now()
      };

      osintData.unshift(newItem);

      map.getSource('osint').setData({
        type: "FeatureCollection",
        features: osintData.map(item => ({
          type: "Feature",
          geometry: { type: "Point", coordinates: item.location },
          properties: { ...item, tags: JSON.stringify(item.tags) }
        }))
      });

      renderOSINT();
    }, 45000);

    // Initialize
    renderOSINT();
    renderClaims();
  </script>

</body>
</html>