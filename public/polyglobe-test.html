<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Polyglobe Test - ProofLocker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #000000;
      color: white;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
    }

    #globe-container {
      width: 100%;
      height: 100%;
      background: #000000;
    }

    /* Minimal overlay for branding */
    #overlay {
      position: absolute;
      top: 30px;
      left: 30px;
      z-index: 100;
      pointer-events: none;
      opacity: 0.8;
    }

    #overlay h1 {
      font-size: 28px;
      font-weight: 700;
      color: #0066ff;
      margin-bottom: 6px;
      letter-spacing: -0.8px;
    }

    #overlay p {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.5);
      font-weight: 400;
    }

    /* Loading indicator */
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
      z-index: 50;
    }

    .fade-out {
      animation: fadeOut 0.5s forwards;
    }

    @keyframes fadeOut {
      to { opacity: 0; pointer-events: none; }
    }
  </style>
</head>
<body>
  <div id="globe-container"></div>

  <div id="overlay">
    <h1>ProofLocker</h1>
    <p>Global Claims Network</p>
  </div>

  <div id="loading">Loading globe...</div>

  <!-- Globe.GL + Three.js from CDN -->
  <script src="//unpkg.com/globe.gl"></script>

  <script>
    // ========================================
    // MOCK CLAIM DATA - 35 global hotspots
    // ========================================
    const mockClaims = [
      // High-density resolved (green)
      { lat: 40.7128, lng: -74.0060, city: 'New York', volume: 9, status: 'resolved', color: '#00cc66' },
      { lat: 35.6762, lng: 139.6503, city: 'Tokyo', volume: 10, status: 'resolved', color: '#00cc66' },
      { lat: 37.7749, lng: -122.4194, city: 'San Francisco', volume: 8, status: 'resolved', color: '#00cc66' },
      { lat: 51.5074, lng: -0.1278, city: 'London', volume: 7, status: 'resolved', color: '#00cc66' },
      { lat: 48.8566, lng: 2.3522, city: 'Paris', volume: 6, status: 'resolved', color: '#00cc66' },

      // Urgent/pending (red)
      { lat: 50.4501, lng: 30.5234, city: 'Kyiv', volume: 10, status: 'urgent', color: '#ff4444' },
      { lat: 33.8869, lng: 35.5131, city: 'Beirut', volume: 6, status: 'urgent', color: '#ff4444' },
      { lat: 31.7917, lng: 35.2172, city: 'Jerusalem', volume: 7, status: 'urgent', color: '#ff4444' },
      { lat: 33.3152, lng: 44.3661, city: 'Baghdad', volume: 6, status: 'urgent', color: '#ff4444' },
      { lat: 34.0522, lng: -118.2437, city: 'Los Angeles', volume: 8, status: 'urgent', color: '#ff4444' },
      { lat: 24.4539, lng: 54.3773, city: 'Abu Dhabi', volume: 5, status: 'urgent', color: '#ff4444' },

      // Pending (blue)
      { lat: 55.7558, lng: 37.6173, city: 'Moscow', volume: 6, status: 'pending', color: '#0066ff' },
      { lat: 39.9042, lng: 116.4074, city: 'Beijing', volume: 8, status: 'pending', color: '#0066ff' },
      { lat: -33.8688, lng: 151.2093, city: 'Sydney', volume: 5, status: 'pending', color: '#0066ff' },
      { lat: 19.4326, lng: -99.1332, city: 'Mexico City', volume: 6, status: 'pending', color: '#0066ff' },
      { lat: -23.5505, lng: -46.6333, city: 'SÃ£o Paulo', volume: 6, status: 'pending', color: '#0066ff' },
      { lat: 28.6139, lng: 77.2090, city: 'Delhi', volume: 7, status: 'pending', color: '#0066ff' },
      { lat: 1.3521, lng: 103.8198, city: 'Singapore', volume: 6, status: 'pending', color: '#0066ff' },
      { lat: 25.2048, lng: 55.2708, city: 'Dubai', volume: 5, status: 'pending', color: '#0066ff' },
      { lat: -34.6037, lng: -58.3816, city: 'Buenos Aires', volume: 5, status: 'pending', color: '#0066ff' },
      { lat: 52.5200, lng: 13.4050, city: 'Berlin', volume: 6, status: 'pending', color: '#0066ff' },
      { lat: 41.9028, lng: 12.4964, city: 'Rome', volume: 5, status: 'pending', color: '#0066ff' },
      { lat: 59.3293, lng: 18.0686, city: 'Stockholm', volume: 4, status: 'pending', color: '#0066ff' },
      { lat: -1.2921, lng: 36.8219, city: 'Nairobi', volume: 4, status: 'pending', color: '#0066ff' },
      { lat: 30.0444, lng: 31.2357, city: 'Cairo', volume: 5, status: 'pending', color: '#0066ff' },
      { lat: -33.9249, lng: 18.4241, city: 'Cape Town', volume: 4, status: 'pending', color: '#0066ff' },
      { lat: 23.1291, lng: -82.3822, city: 'Havana', volume: 3, status: 'pending', color: '#0066ff' },
      { lat: 13.7563, lng: 100.5018, city: 'Bangkok', volume: 5, status: 'pending', color: '#0066ff' },
      { lat: -22.9068, lng: -43.1729, city: 'Rio de Janeiro', volume: 5, status: 'pending', color: '#0066ff' },
      { lat: 41.0082, lng: 28.9784, city: 'Istanbul', volume: 6, status: 'pending', color: '#0066ff' },
      { lat: 45.4215, lng: -75.6972, city: 'Ottawa', volume: 4, status: 'pending', color: '#0066ff' },
      { lat: 22.3193, lng: 114.1694, city: 'Hong Kong', volume: 6, status: 'pending', color: '#0066ff' },
      { lat: -37.8136, lng: 144.9631, city: 'Melbourne', volume: 5, status: 'pending', color: '#0066ff' },
      { lat: 47.6062, lng: -122.3321, city: 'Seattle', volume: 5, status: 'pending', color: '#0066ff' },
      { lat: 43.6532, lng: -79.3832, city: 'Toronto', volume: 5, status: 'pending', color: '#0066ff' },
    ];

    // ========================================
    // INITIALIZE GLOBE
    // ========================================
    const globe = Globe({ animateIn: false })
      (document.getElementById('globe-container'))
      // Dark night Earth with city lights glow
      .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
      // No bump map - smooth surface
      .bumpImageUrl(null)
      // Pure black void background
      .backgroundImageUrl(null)
      .backgroundColor('rgba(0, 0, 0, 1)')
      // Subtle blue atmospheric glow (Polyglobe style)
      .atmosphereColor('#0066ff')
      .atmosphereAltitude(0.2)
      .showAtmosphere(true)
      // Enable point merging for clustering effect
      .pointsMerge(true)
      .pointsTransitionDuration(300);

    // ========================================
    // CONFIGURE PULSING HOTSPOT POINTS
    // ========================================
    globe
      .pointsData(mockClaims)
      .pointLat('lat')
      .pointLng('lng')
      .pointAltitude(0.02) // Float above surface
      .pointRadius(d => {
        // Size by volume: 0.3 to 1.2 units
        return 0.3 + (d.volume / 10) * 0.9;
      })
      .pointColor('color')
      // Minimal tooltip on hover
      .pointLabel(d => `
        <div style="
          padding: 10px 14px;
          background: rgba(0, 0, 0, 0.95);
          border: 1px solid ${d.color};
          border-radius: 6px;
          font-family: -apple-system, sans-serif;
          font-size: 12px;
          line-height: 1.5;
          color: white;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.8);
        ">
          <div style="font-weight: 700; color: ${d.color}; margin-bottom: 4px;">
            ${d.city}
          </div>
          <div style="color: rgba(255,255,255,0.7); font-size: 11px;">
            Volume: ${d.volume}/10 â€¢ Status: ${d.status}
          </div>
        </div>
      `)
      .onPointClick(point => {
        console.log('Clicked point:', point);
        alert(`${point.city}\nVolume: ${point.volume}/10\nStatus: ${point.status}`);
      });

    // ========================================
    // CAMERA & ORBIT CONTROLS
    // ========================================
    const controls = globe.controls();
    controls.autoRotate = true;
    controls.autoRotateSpeed = 0.4; // Slow cinematic rotation
    controls.enableZoom = true;
    controls.enablePan = false; // Lock panning for immersive feel
    controls.minDistance = 101; // Allow close dive-in
    controls.maxDistance = 1000; // Allow pull-back to see full sphere
    controls.enableDamping = true;
    controls.dampingFactor = 0.05; // Smooth inertia
    controls.rotateSpeed = 0.5;
    controls.zoomSpeed = 0.8;

    // Initial camera position - elevated view
    globe.pointOfView({ lat: 20, lng: 0, altitude: 2.5 }, 0);

    // ========================================
    // PULSING ANIMATION LOOP
    // ========================================
    let animationFrame = 0;

    function animatePulse() {
      animationFrame++;

      // Sine wave for smooth pulsing (0.8 â†’ 1.2 scale, 2s cycle)
      const pulseScale = 1 + Math.sin(animationFrame * 0.03) * 0.2;

      // Altitude breathing effect
      const altitudePulse = 0.02 + Math.sin(animationFrame * 0.04) * 0.01;

      globe
        .pointAltitude(d => {
          // Urgent points pulse higher
          if (d.status === 'urgent') {
            return altitudePulse + 0.01;
          }
          return 0.02;
        })
        .pointRadius(d => {
          const baseRadius = 0.3 + (d.volume / 10) * 0.9;

          // Urgent points pulse dramatically
          if (d.status === 'urgent') {
            return baseRadius * pulseScale;
          }

          // Resolved points subtle glow
          if (d.status === 'resolved') {
            return baseRadius * (1 + Math.sin(animationFrame * 0.02) * 0.1);
          }

          // Pending points static
          return baseRadius;
        });

      requestAnimationFrame(animatePulse);
    }

    // Start pulse animation
    animatePulse();

    // ========================================
    // SCENE SETUP (Three.js access)
    // ========================================
    const scene = globe.scene();
    scene.fog = null; // No fog for clarity

    const renderer = globe.renderer();
    renderer.antialias = true;
    renderer.setClearColor(0x000000, 1);

    // ========================================
    // READY STATE
    // ========================================
    setTimeout(() => {
      const loading = document.getElementById('loading');
      loading.classList.add('fade-out');
      setTimeout(() => loading.remove(), 500);

      console.log('ðŸŒ Polyglobe test loaded');
      console.log('Controls:');
      console.log('- Drag to rotate');
      console.log('- Scroll to zoom (dive in/out)');
      console.log('- Hover points for details');
      console.log('- Click points for alert');
      console.log(`\nShowing ${mockClaims.length} hotspots`);
    }, 1000);

    // ========================================
    // RESPONSIVE RESIZE
    // ========================================
    window.addEventListener('resize', () => {
      globe.width(window.innerWidth);
      globe.height(window.innerHeight);
    });
  </script>
</body>
</html>
